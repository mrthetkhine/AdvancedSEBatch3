<html>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ramda/0.28.0/ramda.js"></script>
    <script>
   
        const Left =(value)=>({
            value,
            map(fn)
            {
                return Left.of(value);
            },
            flatMap(fn)
            {
                return value;
            },
            matchWith(context)
            {
                //console.log('Failure ',context);
                return context.left(value);
            },
            and(another)
            {
                return another.matchWith({
                    left:(x)=>Left.of(value+' ,'+x),
                    right:(x)=> Left.of(value),
                }); 
            },
            valueOf()
            {
                return value;
            }
        });
        Left.of = Left;

        const Right =(value)=>({
            value,
            map(fn)
            {
                return Right.of(fn(value));
            },
            flatMap(fn)
            {
                return fn(value);
            },
            matchWith(context)
            {
                //console.log('Sucess ',context);
                return context.right(value);
            },
            and(another)
            {
                return another.matchWith({
                    left:(x)=>Left.of(x),
                    right:(x)=> Right.of(x)
                });
            },
            ap(c) //Container-value fn
            {
                return c.map(value);
            } ,
            valueOf()
            {
                return value;
            }
        });
        Right.of = Right;
       
        let add = (x,y)=>x+y;
        
        //isEmail
        //notEmpty
        //minLength, maxLength
        //min, max

        const isEmpty = (x)=> (x+'') === '';
        const not = (fn)=>x=> !fn(x);
        const notEmpty = not(isEmpty);
        const isEmail = (email)=> email.includes('@');
        const isString = (str)=> typeof str === 'string';
        const isNumber = (num)=> typeof num === 'number';

        const minLength = (len)=>(str)=> isString(str) &&  str.length >= len;
        const maxLength = (len)=>(str)=> isString(str) && str.length <= len;

        const minValue = (value)=> (x)=> isNumber(x) && x >= value;
        const maxValue = (value)=> (x)=> isNumber(x) && x <= value;

        function and(...fns)
        {
            return function (x)
            {
                return fns.reduce((a,fn)=> a && fn(x), true);
            }
        }
        function or(...fns)
        {
            return function (x)
            {
                return fns.reduce((a,fn)=> a || fn(x), false);
            }
        }
        const minMax = and(minLength(3),maxLength(15),isEmail);
        const isNumberOrString = or(isNumber, isString);

        const nameRule = and(isString, notEmpty,minLength(3), maxLength(10));
        const validateUserName = (obj)=> nameRule(obj.name)? Right.of(obj)
                                                           : Left.of('Invalid UserName') ;

        const emailRule = and(isString,isEmail);
        const validateEmail = (obj) => emailRule(obj.email) ?Right.of(obj)
                                                            :Left.of('Invalid email') ;      

        const ageRule = and(isNumber,minValue(0), maxValue(100));
        const validateAge = (obj)=> ageRule(obj.age) ? Right.of(obj)
                                                      : Left.of('Invalid age');

        //const validateObj = and(validateUserName,validateEmail,validateAge);

        //console.log('UserName Rule ', validateUserName(obj).valueOf());
        //console.log('Email Rule ', validateEmail(obj).valueOf());
        //console.log('Age Rule ', validateAge(obj).valueOf());
        //console.log('Validate User ',validateObj(obj));
        
        // const inc = (x)=> x+1;
        function chain(...fns)
        {
            return function (x)
            {
                return fns.reduce( (previous,next)=>{
                    //console.log('Previous ',previous.valueOf());
                    //console.log('Next ',next(x));
                    //console.log('X ',x);
                    return previous.and(next(x));
                } , Right.of(x));
            }
        }
        let obj = {
            name : 'MK3',
            age : 30,
            email : 'someone@gmail.com'
        }
        /*
        console.log('ValidateUserName ',validateUserName(obj));
        console.log('validateEmail ',validateEmail(obj));
        console.log('validateAge ',validateAge(obj));
        */
        const validate = chain(validateUserName,validateEmail,validateAge);
        let validationResult = validate(obj);
        
        //console.log('Validate Result ',validationResult.valueOf());
        //console.log('Validate Result ',validationResult);
        validationResult.matchWith({
            left : (x)=> console.log('Vaidation failed ',x.valueOf()),
            right : (x)=> console.log('Valid Save to DB ',x)
        });
    </script>
</html>